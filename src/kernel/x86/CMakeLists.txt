set(KERNEL_X86_SOURCES
    ${CMAKE_CURRENT_SOURCE_DIR}/boot.c
    ${CMAKE_CURRENT_SOURCE_DIR}/gdt.c
    ${CMAKE_CURRENT_SOURCE_DIR}/idt.c
    ${CMAKE_CURRENT_SOURCE_DIR}/interrupts.c
    ${CMAKE_CURRENT_SOURCE_DIR}/kernel.c
    ${CMAKE_CURRENT_SOURCE_DIR}/paging.c
    ${CMAKE_CURRENT_SOURCE_DIR}/pmm.c
    ${CMAKE_CURRENT_SOURCE_DIR}/process.c
    ${CMAKE_CURRENT_SOURCE_DIR}/syscalls.c
    ${CMAKE_CURRENT_SOURCE_DIR}/tss.c
    )

    if (MOS_BUILD_MODE STREQUAL "DEBUG" AND NOT MOS_GRAPHICS_ENABLED)
        LIST(APPEND KERNEL_X86_SOURCES ${CMAKE_CURRENT_SOURCE_DIR}/vgadisp.c)
    endif()

compile_lib(
    NAME kernel_X86
    SOURCES ${KERNEL_X86_SOURCES}
    FLAGS ${MOS_KERNEL_GCC_FLAGS}
    INCLUDE_DIRECTORIES ${MOS_KERNEL_GCC_INCLUDE_DIRS}
    )

compile_lib(
    NAME kernel_entry
    SOURCES ${CMAKE_CURRENT_SOURCE_DIR}/entry.s
    FLAGS ${MOS_KERNEL_NASM_ELF_MODE_FLAGS}
    INCLUDE_DIRECTORIES ${MOS_KERNEL_ASM_INCLUDE_DIRS}
    )
